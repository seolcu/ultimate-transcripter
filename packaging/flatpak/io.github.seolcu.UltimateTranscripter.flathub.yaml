app-id: io.github.seolcu.UltimateTranscripter
runtime: org.gnome.Platform
runtime-version: "47"
sdk: org.gnome.Sdk
command: ultimate-transcripter-gui

finish-args:
  - --share=network
  - --share=ipc
  - --socket=wayland
  - --socket=fallback-x11

cleanup:
  - /include
  - /lib/pkgconfig
  - /share/doc
  - /share/man

modules:
  - name: ffmpeg
    buildsystem: simple
    build-commands:
      - ./configure --prefix=/app --disable-static --enable-shared --disable-doc --disable-debug --disable-x86asm
      - make -j${FLATPAK_BUILDER_N_JOBS}
      - make install
      - install -Dm644 COPYING.LGPLv2.1 /app/share/licenses/$FLATPAK_ID/ffmpeg/COPYING.LGPLv2.1
    sources:
      - type: archive
        url: https://ffmpeg.org/releases/ffmpeg-8.0.1.tar.xz
        sha256: 05ee0b03119b45c0bdb4df654b96802e909e0a752f72e4fe3794f487229e5a41

  - name: python3-dependencies
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}" --prefix=/app certifi charset-normalizer idna urllib3 requests
      - python3 -c "import pathlib, shutil; target=pathlib.Path('/app/share/licenses/io.github.seolcu.UltimateTranscripter/python3-dependencies'); target.mkdir(parents=True, exist_ok=True); [shutil.copy2(p, target / f'{p.parent.name}-{p.name}') for root in pathlib.Path('/app/lib').glob('python3*/site-packages') for p in root.glob('*.dist-info/licenses/*') if p.is_file()]"
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/e6/ad/3cc14f097111b4de0040c83a525973216457bbeeb63739ef1ed275c1c021/certifi-2026.1.4-py3-none-any.whl
        sha256: 9943707519e4add1115f44c2bc244f782c0249876bf51b6599fee1ffbedd685c
      - type: file
        url: https://files.pythonhosted.org/packages/0a/4c/925909008ed5a988ccbb72dcc897407e5d6d3bd72410d69e051fc0c14647/charset_normalizer-3.4.4-py3-none-any.whl
        sha256: 7a32c560861a02ff789ad905a2fe94e3f840803362c84fecf1851cb4cf3dc37f
      - type: file
        url: https://files.pythonhosted.org/packages/0e/61/66938bbb5fc52dbdf84594873d5b51fb1f7c7794e9c0f5bd885f30bc507b/idna-3.11-py3-none-any.whl
        sha256: 771a87f49d9defaf64091e6e6fe9c18d4833f140bd19464795bc32d966ca37ea
      - type: file
        url: https://files.pythonhosted.org/packages/39/08/aaaad47bc4e9dc8c725e68f9d04865dbcb2052843ff09c97b08904852d84/urllib3-2.6.3-py3-none-any.whl
        sha256: bf272323e553dfb2e87d9bfd225ca7b0f467b919d7bbd355436d3fd37cb0acd4
      - type: file
        url: https://files.pythonhosted.org/packages/1e/db/4254e3eabe8020b458f1a747140d32277ec7a271daf1d235b70dc0b4e6e3/requests-2.32.5-py3-none-any.whl
        sha256: 2462f94637a34fd532264295e186976db0f5d453d1cdd31473c85a6a161affb6

  - name: ultimate-transcripter
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app --no-build-isolation --no-deps .
      - install -Dm644 LICENSE /app/share/licenses/$FLATPAK_ID/ultimate-transcripter/LICENSE
      - install -Dm644 packaging/flatpak/io.github.seolcu.UltimateTranscripter.desktop /app/share/applications/io.github.seolcu.UltimateTranscripter.desktop
      - install -Dm644 packaging/flatpak/io.github.seolcu.UltimateTranscripter.metainfo.xml /app/share/metainfo/io.github.seolcu.UltimateTranscripter.metainfo.xml
      - install -Dm644 packaging/flatpak/io.github.seolcu.UltimateTranscripter.svg /app/share/icons/hicolor/scalable/apps/io.github.seolcu.UltimateTranscripter.svg
    sources:
      - type: git
        url: https://github.com/seolcu/ultimate-transcripter.git
        branch: main
        # For Flathub review, pin to a release commit when available.
        # commit: <replace-with-commit-hash>
